$("#changeLang").change(()=>{window.location=$("#changeLang").val()}),document.getElementsByTagName("nav")[0].classList.add("border-bottom"),window.pageYOffset===0&&document.getElementsByTagName("nav")[0].classList.remove("border-bottom"),document.onscroll=()=>{if(window.pageYOffset===0){document.getElementsByTagName("nav")[0].classList.remove("border-bottom");return}document.getElementsByTagName("nav")[0].classList.add("border-bottom")},document.getElementById("menu-button").onclick=()=>{let e=document.getElementById("menu-icon");if(e.classList.contains("open")){e.classList.remove("open");return}e.classList.add("open")};function setAPIkeyStatus(){let e=localStorage.getItem("apiKey");e&&$("#apiKey").val(e)}function setNewAPIkey(){let e=$("#apiKey").val().trim();e&&e!==localStorage.getItem("apiKey")&&localStorage.setItem("apiKey",e)}function clearTextBox(){$("#inputText").val(""),$("#outputText").val(""),$("#outputTranscription").val("")}[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(e=>new bootstrap.Tooltip(e)),setAPIkeyStatus(),$("#apiKey").change(setNewAPIkey),$("#clearButton").click(clearTextBox),$("#clipboard-tkonline").click(copyToClipboard);const recordStart=document.querySelector("#recordStartButton"),recordStop=document.querySelector("#stopRecordingButton"),resumeButton=document.querySelector("#continueRecordingButton"),recordEnd=document.querySelector("#recordEndButton"),cancelButton=document.querySelector("#cancelRecordingButton"),newRecordingButton=document.querySelector("#newRecordingButton"),audioPlayer=document.querySelector("#audioPlayer"),durationDisplay=document.getElementById("duration");let mediaRecorder=null,chunks=[],startTime,durationInterval,totalDuration=0;function resetTimer(){startTime=null,durationInterval=null,totalDuration=0,durationDisplay.textContent="0 s"}recordStart.onclick=()=>{navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{mediaRecorder===null&&(mediaRecorder=new MediaRecorder(e,{audioBitsPerSecond:16e3}),mediaRecorder.onstop=()=>{const e=new Blob(chunks,{type:"audio/wav; codecs=0"});chunks=[],document.querySelector("audio").src=URL.createObjectURL(e),transferAudioToInputFile(e),mediaTranslation()},mediaRecorder.ondataavailable=e=>{chunks.push(e.data)}),mediaRecorder.start(),resetTimer(),startTime=Date.now(),durationInterval=setInterval(updateDuration,1e3),recordStart.disabled=!0,recordStop.disabled=!1,resumeButton.disabled=!0,cancelButton.disabled=!0,newRecordingButton.disabled=!0},e=>console.error("Error: "+e))},recordStop.onclick=()=>{mediaRecorder.pause(),clearInterval(durationInterval),totalDuration+=Math.round((Date.now()-startTime)/1e3),recordStart.disabled=!0,recordStop.disabled=!0,resumeButton.disabled=!1,recordEnd.disabled=!1,cancelButton.disabled=!1,newRecordingButton.disabled=!0},resumeButton.onclick=()=>{mediaRecorder.resume(),startTime=Date.now(),durationInterval=setInterval(updateDuration,1e3),recordStart.disabled=!0,recordStop.disabled=!1,recordEnd.disabled=!1,resumeButton.disabled=!0,cancelButton.disabled=!1,newRecordingButton.disabled=!0},recordEnd.onclick=()=>{mediaRecorder.stop(),clearInterval(durationInterval),totalDuration+=Math.round((Date.now()-startTime)/1e3),recordStart.disabled=!1,recordStop.disabled=!0,recordEnd.disabled=!0,resumeButton.disabled=!0,cancelButton.disabled=!1,newRecordingButton.disabled=!0},cancelButton.onclick=()=>{mediaRecorder=null,chunks=[],document.querySelector("audio").src="",recordStart.disabled=!1,recordStop.disabled=!0,resumeButton.disabled=!0,cancelButton.disabled=!0,newRecordingButton.disabled=!1,location.reload()};function updateDuration(){const e=totalDuration+Math.round((Date.now()-startTime)/1e3);durationDisplay.textContent=`${e} s`}newRecordingButton.onclick=()=>{mediaRecorder=null,chunks=[],document.querySelector("audio").src="",recordStart.disabled=!1,recordStop.disabled=!0,resumeButton.disabled=!0,cancelButton.disabled=!1,newRecordingButton.disabled=!0};function transferAudioToInputFile(e){const n=document.getElementById("inputFile"),s=new File([e],"recording.wav"),t=new DataTransfer;t.items.add(s),n.files=t.files}function copyToClipboard(){let e=$("#outputTranscription");e.select(),navigator.clipboard.writeText(e.val())}let inputFile=document.getElementById("inputFile");inputFile.addEventListener("change",function(){let e=inputFile.files[0];e&&(console.log("Archivo seleccionado:",e.name),$("#filename").text("Archivo seleccionado: "+e.name))}),$("#transcribeButton").click(mediaTranslation);async function mediaTranslation(){const t="https://api.trebesrv.com/transcription/v1/demo/transcribe";$("#responseBad").css("display","none"),$("#wait_email").css("display","none"),$("#loading_file").css("display","block");let e=$("#inputFile").prop("files")[0];if(e!=null){let a=$("#model").val(),s=localStorage.getItem("apiKey").split("_"),o=s.shift(),i=s.join("_"),r=i===""?{apikey:o}:{apikey:o,"X-Trebe-Email-To":i},n=new FormData;n.append("file",e),n.append("apikey",localStorage.getItem("apiKey")),n.append("delivery",$("input[name=email-response]:checked").val()),n.append("languagemodel",a),$("#diarization").is(":checked")&&n.append("diarization","auto"),$("#output-name").val()&&n.append("outfilename",$("#output-name").val()),$("#format-srt").is(":checked")&&n.append("formats","srt"),$("#format-rtf").is(":checked")&&n.append("formats","rtf"),$("#format-stl").is(":checked")&&n.append("formats","stl"),$("#format-vtt").is(":checked")&&n.append("formats","vtt"),$("#format-txt").is(":checked")&&n.append("formats","txt"),$("#format-xml").is(":checked")&&n.append("formats","xml"),$("#format-json").is(":checked")&&n.append("formats","json"),$("#format-mjson").is(":checked")&&n.append("formats","mjson");let c={method:"POST",headers:r,body:n};fetch(t,c).then(e=>e.json()).then(t=>{if(t.message!==void 0||t.error!==void 0)$("#responseBad").html(t.message||t.error),$("#loading_file").css("display","none"),$("#wait_email").css("display","none"),$("#responseBad").css("display","block");else{$("#loading_file").css("display","none"),$("#wait_email").css("display","block"),console.log("Correo enviado con el archivo: ",e.name),$("#filename").text("Archivo Mandado: "+e.name);let t=$("#output-name").val();alert("TrancripciÃ³n mandada: "+t),n.append("outfilename",t)}}).catch(e=>{$("#responseBad").html(e),$("#loading_file").css("display","none"),$("#wait_email").css("display","none"),$("#responseBad").css("display","block")})}else $("#responseBad").html("No file selected"),$("#loading_file").css("display","none"),$("#wait_email").css("display","none"),$("#responseBad").css("display","block")}